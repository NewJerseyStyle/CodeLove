# ============================================================================
# 源界 (Source Realm) - 心動表現系統
# ============================================================================

init python:
    def get_crush_reaction(char_id):
        """根據心動狀態返回反應對白，有機率觸發"""
        import random
        
        # 如果沒觸發 crush，或機率沒中，返回空
        is_crush = getattr(store, f"crush_{char_id}", False)
        if not is_crush or random.random() > 0.4:
            return None
            
        reactions = {
            "cee": [
                'cee "（正偷偷盯著你看，被發現後猛地轉過頭，耳朵微紅）"',
                'cee "（低聲自語）語法掌握度 100%... 為什麼... 心跳頻率也在同步上升..."',
                'cee "（遞給你一塊抹布）給。你的位址... 很整潔。"'
            ],
            "jawa": [
                'jawa "（看到你時，推眼鏡的手指微微顫抖）"',
                'jawa "（眼神閃躲）那個…… 關於上次的語法對決…… 你的邏輯非常優雅。"',
                'jawa "（突然停止說話，眼神閃爍，幾秒後）……啊，剛才是因為 GC 暫停了……不…不是因為緊張。"'
            ],
            "rusty": [
                'rusty "（臉紅得像熟透的番茄）哇！是、是語法大師來了！"',
                'rusty "（絞著手指）那個... 我能借用一下你的時間嗎？不、不是那個意思！是安全借用！"',
                'rusty "（偷偷看你的側面，小聲）如果代碼都能像他一樣完美就好了..."'
            ],
            "py": [
                'py "（原本懶洋洋的，看到你後立刻坐直了，試圖理順頭髮）"',
                'py "嘿，大天才。要不要來我這邊睡個午覺？我給你留了四格縮排的位置。"',
                'py "（盯著你看，嘴角帶著一絲壞笑）能讓我的強迫症都消失的人，你還是第一個。"'
            ]
        }
        
        return random.choice(reactions.get(char_id, [None]))

# ============================================================================
# 章節前的預處理
# ============================================================================

label check_crush_before_event(char_id):
    $ reaction = get_crush_reaction(char_id)
    if reaction:
        $ renpy.say(None, "在開始之前...")
        $ renpy.jump_out_of_context("crush_interaction_label") # 此處需更複雜邏輯，暫用簡單方式
    return
